<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="920" height="360" viewBox="0 0 920 360" aria-label="Web4 Handshake State Machine">
  <title>Web4 Handshake State Machine</title>
  <rect x="10" y="10" width="900" height="340" rx="12" ry="12" fill="#f7f7f7" stroke="#ccc"/>
  <g font-family="Inter, Arial, sans-serif" font-size="14">
    <rect x="60" y="60" width="140" height="40" rx="8" fill="#fff" stroke="#333"/>
    <text x="130" y="85" text-anchor="middle">Start</text>

    <rect x="260" y="60" width="180" height="40" rx="8" fill="#fff" stroke="#333"/>
    <text x="350" y="85" text-anchor="middle">SendClientHello</text>

    <rect x="500" y="60" width="180" height="40" rx="8" fill="#fff" stroke="#333"/>
    <text x="590" y="85" text-anchor="middle">WaitServerHello</text>

    <rect x="260" y="160" width="180" height="40" rx="8" fill="#fff" stroke="#333"/>
    <text x="350" y="185" text-anchor="middle">DeriveHPKE</text>

    <rect x="500" y="160" width="180" height="40" rx="8" fill="#fff" stroke="#333"/>
    <text x="590" y="185" text-anchor="middle">SendAuth</text>

    <rect x="740" y="160" width="140" height="40" rx="8" fill="#fff" stroke="#333"/>
    <text x="810" y="185" text-anchor="middle">WaitAuth</text>

    <rect x="500" y="260" width="180" height="40" rx="8" fill="#eaffea" stroke="#1a7f37"/>
    <text x="590" y="285" text-anchor="middle">Established</text>

    <rect x="740" y="260" width="140" height="40" rx="8" fill="#ffecec" stroke="#b91c1c"/>
    <text x="810" y="285" text-anchor="middle">Error</text>

    <!-- Arrows -->
    <defs>
      <marker id="arrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
      </marker>
    </defs>
    <line x1="200" y1="80" x2="260" y2="80" stroke="#333" marker-end="url(#arrow)"/>
    <line x1="440" y1="80" x2="500" y2="80" stroke="#333" marker-end="url(#arrow)"/>
    <line x1="590" y1="100" x2="350" y2="160" stroke="#333" marker-end="url(#arrow)"/>
    <line x1="440" y1="180" x2="500" y2="180" stroke="#333" marker-end="url(#arrow)"/>
    <line x1="680" y1="180" x2="740" y2="180" stroke="#333" marker-end="url(#arrow)"/>
    <line x1="740" y1="180" x2="590" y2="260" stroke="#333" marker-end="url(#arrow)"/>
    <line x1="740" y1="180" x2="810" y2="260" stroke="#333" marker-end="url(#arrow)"/>
  </g>
</svg>
